sudo: required

services:
  - docker

install:
  - docker build -t keboola/db-writer-mysql .
  - docker run -v $(pwd):/code keboola/db-writer-mysql composer install --prefer-dist --no-interaction
  - source ./vendor/keboola/db-writer-common/tests/generate-ssh-keys.sh

script:
  - docker-compose run wait
  - docker-compose run tests

deploy:
  provider: script
  skip_cleanup: true
  script: ./deploy.sh
  on:
    tags: true

notifications:
  slack: $SLACK_INTEGRATION_DOMAIN:$SLACK_INTEGRATION_KEY
